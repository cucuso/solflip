<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Image Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #gameUI {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-family: Arial, sans-serif;
        }

        #balance {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        #betInput {
            width: 100px;
            padding: 8px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .bet-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .bet-button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
        }

        #headsButton {
            background: #3498db;
            color: white;
        }

        #headsButton:hover {
            background: #2980b9;
        }

        #tailsButton {
            background: #e74c3c;
            color: white;
        }

        #tailsButton:hover {
            background: #c0392b;
        }

        .bet-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #result {
            margin-top: 10px;
            font-weight: bold;
            font-size: 14px;
            min-height: 20px;
        }

        .win {
            color: #27ae60;
        }

        .lose {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="gameUI">
            <div id="balance">Balance: $0</div>
            <div>
                <label for="betAmount">Bet Amount: $</label>
                <input type="number" id="betInput" min="1" value="10">
            </div>
            <div class="bet-buttons">
                <button id="headsButton" class="bet-button">Heads</button>
                <button id="tailsButton" class="bet-button">Tails</button>
            </div>
            <div id="result"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, plane, isFlipped = false;
        let balance = Math.floor(Math.random() * 901) + 100; // Random between 100-1000
        let isAnimating = false;
        let flipSound;

        function init() {
            // Create flip sound using Web Audio API
            createFlipSound();

            // Create scene
            scene = new THREE.Scene();

            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 3;

            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0xffffff);
            document.getElementById('container').appendChild(renderer.domElement);

            // Load coin textures
            const textureLoader = new THREE.TextureLoader();
            const headsTexture = textureLoader.load('heads.png');
            const tailsTexture = textureLoader.load('tails.png');

            // Create plane geometry
            const geometry = new THREE.PlaneGeometry(4, 4);

            // Create materials for both sides
            const headsMaterial = new THREE.MeshBasicMaterial({
                map: headsTexture,
                transparent: true
            });

            const tailsMaterial = new THREE.MeshBasicMaterial({
                map: tailsTexture,
                transparent: true
            });

            // Create a group to hold both sides of the coin
            const coinGroup = new THREE.Group();

            // Create heads side (front)
            const headsPlane = new THREE.Mesh(geometry, headsMaterial);
            headsPlane.position.z = 0.01; // Slightly forward
            coinGroup.add(headsPlane);

            // Create tails side (back) - rotated 180 degrees
            const tailsPlane = new THREE.Mesh(geometry, tailsMaterial);
            tailsPlane.rotation.y = Math.PI;
            tailsPlane.position.z = -0.01; // Slightly backward
            coinGroup.add(tailsPlane);

            plane = coinGroup;
            scene.add(plane);

            // Update balance display
            updateBalanceDisplay();

            // Add button functionality
            document.getElementById('headsButton').addEventListener('click', () => placeBet('heads'));
            document.getElementById('tailsButton').addEventListener('click', () => placeBet('tails'));

            // Handle window resize
            window.addEventListener('resize', onWindowResize);

            // Start animation loop
            animate();
        }

        function updateBalanceDisplay() {
            document.getElementById('balance').textContent = `Balance: $${balance}`;
        }

        function placeBet(choice) {
            if (isAnimating) return;

            const betAmount = parseInt(document.getElementById('betInput').value);
            if (betAmount <= 0 || betAmount > balance) {
                document.getElementById('result').textContent = 'Invalid bet amount!';
                document.getElementById('result').className = 'lose';
                return;
            }

            isAnimating = true;
            document.getElementById('headsButton').disabled = true;
            document.getElementById('tailsButton').disabled = true;
            document.getElementById('result').textContent = 'Flipping...';
            document.getElementById('result').className = '';

            // Generate random outcome (0 = heads, 1 = tails)
            const outcome = Math.floor(Math.random() * 2);
            const outcomeText = outcome === 0 ? 'heads' : 'tails';
            const won = choice === outcomeText;

            flipImage(outcome, choice, betAmount, won);
        }

        function createFlipSound() {
            // Load flip sound from audio file
            const audio = new Audio('flip-sound.mp3');
            audio.preload = 'auto';

            function playFlipSound() {
                try {
                    // Reset audio to beginning and play
                    audio.currentTime = 0;
                    audio.play().catch(e => {
                        console.log('Audio playback failed:', e);
                    });
                } catch (e) {
                    console.log('Audio not available');
                }
            }

            flipSound = playFlipSound;
        }

        function flipImage(outcome, playerChoice, betAmount, won) {
            // Play flip sound
            if (flipSound) {
                flipSound();
            }

            // Determine final rotation based on outcome
            const targetRotationY = outcome === 0 ? 0 : Math.PI; // 0 = heads, Ï€ = tails
            const startRotation = plane.rotation.y;
            const startPosition = { x: plane.position.x, y: plane.position.y };
            const startScale = { x: plane.scale.x, y: plane.scale.y };

            // Animation phases
            const totalDuration = 2000; // 2 seconds total
            const spinDuration = 1500; // First 1.5 seconds for spinning
            const landingDuration = 500; // Last 0.5 seconds for landing

            const numberOfSpins = 6; // Number of full rotations
            const flipHeight = 1.5; // How high the coin goes

            const startTime = performance.now();

            function animateFlip(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / totalDuration, 1);

                if (progress <= spinDuration / totalDuration) {
                    // Spinning phase
                    const spinProgress = (elapsed / spinDuration);

                    // Multiple rotations with deceleration
                    const spinEase = 1 - Math.pow(1 - spinProgress, 3);
                    plane.rotation.y = startRotation + (numberOfSpins * Math.PI * 2 * spinEase);

                    // Parabolic trajectory (up then down)
                    const heightProgress = Math.sin(spinProgress * Math.PI);
                    plane.position.y = startPosition.y + (flipHeight * heightProgress);

                    // Slight horizontal drift
                    plane.position.x = startPosition.x + Math.sin(spinProgress * Math.PI * 2) * 0.2;

                    // Scale variation for depth effect
                    const scaleVariation = 1 + Math.sin(spinProgress * Math.PI * numberOfSpins) * 0.1;
                    plane.scale.set(scaleVariation, scaleVariation, 1);

                } else {
                    // Landing phase
                    const landingProgress = (elapsed - spinDuration) / landingDuration;
                    const landingEase = 1 - Math.pow(1 - landingProgress, 4);

                    // Settle to final rotation
                    const finalRotation = startRotation + (numberOfSpins * Math.PI * 2) + targetRotationY;
                    plane.rotation.y = finalRotation;

                    // Bounce effect on landing
                    const bounceHeight = Math.max(0, (1 - landingProgress) * 0.2 *
                                        Math.sin(landingProgress * Math.PI * 8));
                    plane.position.y = startPosition.y + bounceHeight;

                    // Return to center position
                    plane.position.x = startPosition.x * (1 - landingEase);

                    // Return to normal scale with slight overshoot
                    const scaleOvershoot = 1 + (1 - landingProgress) * 0.1 *
                                         Math.sin(landingProgress * Math.PI * 6);
                    plane.scale.set(scaleOvershoot, scaleOvershoot, 1);
                }

                if (progress < 1) {
                    requestAnimationFrame(animateFlip);
                } else {
                    // Ensure final state
                    plane.rotation.y = targetRotationY;
                    plane.position.set(startPosition.x, startPosition.y, 0);
                    plane.scale.set(1, 1, 1);

                    // Update game state
                    finishFlip(outcome, playerChoice, betAmount, won);
                }
            }

            requestAnimationFrame(animateFlip);
        }

        function finishFlip(outcome, playerChoice, betAmount, won) {
            const outcomeText = outcome === 0 ? 'heads' : 'tails';

            if (won) {
                balance += betAmount;
                document.getElementById('result').textContent = `${outcomeText.toUpperCase()}! You won $${betAmount}!`;
                document.getElementById('result').className = 'win';
            } else {
                balance -= betAmount;
                document.getElementById('result').textContent = `${outcomeText.toUpperCase()}! You lost $${betAmount}.`;
                document.getElementById('result').className = 'lose';
            }

            updateBalanceDisplay();

            // Re-enable buttons
            isAnimating = false;
            document.getElementById('headsButton').disabled = false;
            document.getElementById('tailsButton').disabled = false;

            // Check if player is out of money
            if (balance <= 0) {
                document.getElementById('result').textContent += ' Game Over!';
                document.getElementById('headsButton').disabled = true;
                document.getElementById('tailsButton').disabled = true;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            // Optional: Add subtle rotation
            // plane.rotation.x += 0.001;

            renderer.render(scene, camera);
        }

        // Initialize the scene
        init();
    </script>
</body>
</html>